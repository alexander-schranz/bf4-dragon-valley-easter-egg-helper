<!doctype html>
<html>
<head>
   <title>BF4: Dragon Valley Easter Egg Helper</title>
   <style>
        body {
            margin: 40px 20px;
            font-family: Times, Arial;
            background: url("http://subtlepatterns2015.subtlepatterns.netdna-cdn.com/patterns/simple_dashed.png");
            color: #333;
        }
        
        .wrapper {
            background: white;
            max-width: 560px;
            padding: 10px 20px 40px;
            margin: 0 auto;
            box-shadow: 0 0 10px #ccc;
        }
        
        th, td {
            text-align: left;
        }
        
        .light {
            display: none;
        }
        
        .light:checked+label {
            color: #333;
            background-color: yellow;
        }
        
        .light+label {
            display: block;
            text-align: center;
            line-height: 46px;
            width: 46px;
            height: 46px;
            background-color: grey;
            color: white;
            cursor: pointer;
            font-family: Sans-serif;
        }
        
        #error {
            display: none;
            color: red;
            text-align: right;
        }
        
        .text-center {
            text-align: center;
        }
        
        .box-center {
            display: inline-block;
        }
        
        .grid {
            background: url("http://subtlepatterns2015.subtlepatterns.netdna-cdn.com/patterns/gridme.png") top center;
            padding: 20px 10px;
        }
        
        a {
            color: blue;
        }
        
        h1 {
            font-size: 1.8em;
            text-align: center;
        }
        
        h2 {
            font-size: 1.5em;
            text-align: center;
        }
        
        p {
            text-align: center;
        }
        
        table {
            margin: 0 auto;
        }
        
        iframe {
            border: 0;
            display: block;
            margin: 0 auto;
        }
   </style>
</head>
<body>
    <div class="wrapper">
        <h1>
            BF4 Dragon Valley Easter Egg Helper<br/>
            <small>
                v3.0<br/>
                by Lexo91
            </small>
        </h1>
        <p>
            Inspired by
            <a href="https://www.youtube.com/watch?v=JuuzmOXL1bc" target="_blank"><strong>JackFraq</strong></a>
            and 
            <a href="https://www.youtube.com/watch?v=e6PcPuJOZ18" target="_blank"><strong>Apollo_v7</strong></a>
            <br/>
            I created a little helper to get all <strong>20 lamps</strong> burning.
        </p>
        <p>
            <a href="http://battlelog.battlefield.com/bf4/forum/threadview/2979150494244429566/">Any Questions or Feedback?</a>
        </p>
        <section>
            <fieldset class="grid">
                <legend>
                    Lamps
                </legend>
                <table>
                    <thead>
                        <tr>
                            <th colspan="7" class="text-center">
                                North
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <input type="checkbox" name="light1" id="light1" class="light" data-number="1" />
                                <label for="light1">1</label>
                            </td>
                            <td>
                                <input type="checkbox" name="light2" id="light2" class="light" data-number="2" />
                                <label for="light2">2</label>
                            </td>
                            <td>
                                <input type="checkbox" name="light3" id="light3" class="light" data-number="3" />
                                <label for="light3">3</label>
                            </td>
                            <td>
                                <input type="checkbox" name="light4" id="light4" class="light" data-number="4" />
                                <label for="light4">4</label>
                            </td>
                            <td>
                                <input type="checkbox" name="light5" id="light5" class="light" data-number="5" />
                                <label for="light5">5</label>
                            </td>
                            <td>
                                <input type="checkbox" name="light6" id="light6" class="light" data-number="6" />
                                <label for="light6">6</label>
                            </td>
                            <td>
                                <input type="checkbox" name="light7" id="light7" class="light" data-number="7" />
                                <label for="light7">7</label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" name="light20" id="light20" class="light" data-number="20" />
                                <label for="light20">20</label>
                            </td>
                            <td colspan="5">
                            </td>
                            <td>
                                <input type="checkbox" name="light8" id="light8" class="light" data-number="8" />
                                <label for="light8">8</label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" name="light19" id="light19" class="light" data-number="19" />
                                <label for="light19">19</label>
                            </td>
                            <td colspan="5">
                            </td>
                            <td>
                                <input type="checkbox" name="light9" id="light9" class="light" data-number="9" />
                                <label for="light9">9</label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" name="light18" id="light18" class="light" data-number="18" />
                                <label for="light18">18</label>
                            </td>
                            <td colspan="5">
                            </td>
                            <td>
                                <input type="checkbox" name="light10" id="light10" class="light" data-number="10" />
                                <label for="light10">10</label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" name="light17" id="light17" class="light" data-number="17" />
                                <label for="light17">17</label>
                            </td>
                            <td>
                                <input type="checkbox" name="light16" id="light16" class="light" data-number="16" />
                                <label for="light16">16</label>
                            </td>
                            <td>
                                <input type="checkbox" name="light15" id="light15" class="light" data-number="15" />
                                <label for="light15">15</label>
                            </td>
                            <td>
                                <input type="checkbox" name="light14" id="light14" class="light" data-number="14" />
                                <label for="light14">14</label>
                            </td>
                            <td>
                                <input type="checkbox" name="light13" id="light13" class="light" data-number="13" />
                                <label for="light13">13</label>
                            </td>
                            <td>
                                <input type="checkbox" name="light12" id="light12" class="light" data-number="12" />
                                <label for="light12">12</label>
                            </td>
                            <td>
                                <input type="checkbox" name="light11" id="light11" class="light" data-number="11" />
                                <label for="light11">11</label>
                            </td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="7" class="text-center">
                                <br/>
                                <label for="last-input" class="box-center">Last active Lights:</label>
                                <div>
                                    <button id="history-back" disabled>&#x2190;</button>
                                    <input type="text" name="last-input" id="last-input" class="box-center" readonly />
                                    <button id="history-forward" disabled>&#x2192;</button>
                                </div>
                                <button id="reset-lights" class="box-center" disabled>Reset lights</button>
                            </td>
                        </tr>
                    </tfoot>
                </table>
            </fieldset>
        </section>
        <section>
            <fieldset>
                <legend>
                    Triggers
                </legend>
                <table>
                    <thead>
                        <tr>
                            <th>
                                Location
                            </th>
                            <th>
                                Lights
                            </th>
                            <th>
                                Set
                            </th>
                            <th>
                                Toggle
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <label for="values0">Beginning</label>
                            </td>
                            <td>
                                <input type="text" name="values0" id="values0" class="values" readonly />
                            </td>
                            <td colspan="2">
                                <button class="analyse" id="analyse0">
                                    Set Lights
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label for="values1">Temple (H)</label>
                            </td>
                            <td>
                                <input type="text" name="values1" id="values1" class="values" readonly />
                            </td>
                            <td>
                                <button class="analyse" id="analyse1" disabled>
                                    Trigger
                                </button>
                            </td>
                            <td>
                                <input type="checkbox" class="toggle" id="toggle1" disabled />
                                <label for="toggle1"></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label for="values2">Furnace (C)</label>
                            </td>
                            <td>
                                <input type="text" name="values2" id="values2" class="values" readonly />
                            </td>
                            <td>
                                <button class="analyse" id="analyse2" disabled>
                                    Trigger
                                </button>
                            </td>
                            <td>
                                <input type="checkbox" class="toggle" id="toggle2" disabled />
                                <label for="toggle2"></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label for="values3">Tree (A)</label>
                            </td>
                            <td>
                                <input type="text" name="values3" id="values3" class="values" readonly />
                            </td>
                            <td>
                                <button class="analyse" id="analyse3" disabled>
                                    Trigger
                                </button>
                            </td>
                            <td>
                                <input type="checkbox" class="toggle" id="toggle3" disabled />
                                <label for="toggle3"></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label for="values4">Waterfall (D)</label>
                            </td>
                            <td>
                                <input type="text" name="values4" id="values4" class="values" readonly />
                            </td>
                            <td>
                                <button class="analyse" id="analyse4" disabled>
                                    Trigger
                                </button>
                            </td>
                            <td>
                                <input type="checkbox" class="toggle" id="toggle4" disabled />
                                <label for="toggle4"></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label for="values5">Pier (G)</label>
                            </td>
                            <td>
                                <input type="text" name="values5" id="values5" class="values" readonly />
                            </td>
                            <td>
                                <button class="analyse" id="analyse5" disabled>
                                    Trigger
                                </button>
                            </td>
                            <td>
                                <input type="checkbox" class="toggle" id="toggle5" disabled />
                                <label for="toggle5"></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label for="values6">Rock (E)</label>
                            </td>
                            <td>
                                <input type="text" name="values6" id="values6" class="values" readonly />
                            </td>
                            <td>
                                <button class="analyse" id="analyse6" disabled>
                                    Trigger
                                </button>
                            </td>
                            <td>
                                <input type="checkbox" class="toggle" id="toggle6" disabled />
                                <label for="toggle6"></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label for="values7">Pagoda (B)</label>
                            </td>
                            <td>
                                <input type="text" name="values7" id="values7" class="values" readonly />
                            </td>
                            <td>
                                <button class="analyse" id="analyse7" disabled>
                                    Trigger
                                </button>
                            </td>
                            <td>
                                <input type="checkbox" class="toggle" id="toggle7" disabled />
                                <label for="toggle7"></label>
                            </td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="2">
                                <button id="reset-toggle" disabled>
                                    Reset Toggle Status
                                </button>    
                            </td>
                            <td colspan="2">
                                <button id="magic-toggle" disabled>
                                    Calculate
                                </button>    
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <button id="reset-trigger" disabled>
                                    Reset Triggers
                                </button>    
                            </td>
                            <td colspan="2">
                                <div id="error">Error</div>
                            </td>
                        </tr>
                    </tfoot>
                </table>
            </fieldset>
        </section>
        <section>
            <h2>How to use this helper</h2>
            <ol>
                <li>Check all currently burning lights and click <b>"Set Lights"</b> for <b>"Beginning"</b></li>
                <li>Go the a <b>button</b> trigger it <b>check all currently burning lights</b> and click <b>"Trigger"</b></li>
                <li>Continue doing this for the other buttons</li>
                <li>Check the <b>correctness</b> of all <b>currently burning lights</b></li>
                <li>Click on the <b>"Calculate"</b> button this will tell you which buttons you need to click again</li>
                <li><a href="http://battlelog.battlefield.com/bf4/forum/threadview/2955065246879560123/1/" target="_blank">Continue the Guide</a></li>
            </ol>
        </section>
        <section>
            <h2>Locations</h2>
            <iframe src="https://www.youtube.com/embed/e6PcPuJOZ18" width="480" height="260"></iframe>
        </section>
    </div>
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script>        
        $(document).ready(function() {
            // convert string to numeric
            var toNumeric = function(n,i) {
                return isNaN(parseInt(n)) ? n : parseInt(n);
            };
            
            var lightHistory = [[]];
            var lightHistoryIndex = 0;
            
            // get last active lights
            var getLastActiveLights = function() {
                return $.map($('#last-input').val().split(','), toNumeric);
            };
            
            // set current as last
            var setCurrentAsLast = function() {
                var lastValues = [];
                $('.light:checked').each(function() {
                    lastValues.push($(this).data('number'));
                });
                
                setLastActiveLights(lastValues, false);
            };
            
            // last active history navigation
            var lastActiveHistory = function() {
                if (lightHistoryIndex >= 0 && lightHistoryIndex < lightHistory.length) {
                    setLastActiveLights(lightHistory[lightHistoryIndex], true)
                } else {
                    if (lightHistoryIndex < 0) {
                        lightHistoryIndex = 0;
                    }
                    
                    if (lightHistoryIndex >= lightHistory.length) {
                        lightHistoryIndex = lightHistory.length - 1;
                    }
                }
            };
            
            // set last acitve lights
            var setLastActiveLights = function(lastValues, ignoreHistory) {
                $('#last-input').val(lastValues.join(','));
                
                if (!ignoreHistory) {
                    lightHistory.push(lastValues);
                    lightHistoryIndex = lightHistory.length - 1;
                }
                
                if (lightHistoryIndex === 0) {
                    $('#history-back').prop('disabled', true);
                } else {
                    $('#history-back').prop('disabled', false);
                }
                
                if (lightHistoryIndex < lightHistory.length-1) {
                    $('#history-forward').prop('disabled', false);
                } else {
                    $('#history-forward').prop('disabled', true);
                }
            };
            
            // reset toggle to uncheck
            var resetToggle = function() {
                $('.toggle').prop('checked', false);
            };
            
            // light clicked
            $('.light').click(function() {
                // activate reset light button
                $('#reset-lights').prop('disabled', false);
            });
            
            
            // reset lights button
            $('#reset-lights').click(function() {
                $('.light').prop('checked', false);
                getLastActiveLights();
                
                // get last checked values
                var lastValues = getLastActiveLights();
                
                // check last values
                for (var i in lastValues) {
                    if (lastValues[i]) {
                        $('#light'+lastValues[i]).prop('checked', true);
                    }
                }
            });
        
            // analyse
            $('.analyse').click(function() {
                // get current checked values
                var values = [];
                $('.light:checked').each(function() {
                    values.push($(this).data('number'));
                });
                
                // get last checked values
                var lastValues = getLastActiveLights();
                
                // remove unchanged and add removed
                for (var i in lastValues) {
                    if (lastValues[i]) {
                        var lastIndex = $.inArray(lastValues[i], values);
                        if (lastIndex !== -1) {
                            values.splice(lastIndex, 1);
                        } else {
                            values.push(lastValues[i]);
                        }
                    }
                }
                
                // set values for this analyse
                $(this).closest('tr').find('.values').val(values.join(','));
                
                // set this as last
                setCurrentAsLast();
                
                // enabled other analyse
                if ($(this).attr('id') === 'analyse0') {
                    $('.analyse').prop('disabled', false);
                } else {
                    $('#reset-trigger').prop('disabled', false);
                }
                
                // disabled reanalyse
                $(this).prop('disabled', true);
                // enable toggle button
                $('#' + $(this).attr('id').replace('analyse', 'toggle')).prop('disabled', false);
                
                // enabled calculate
                if ($('.analyse:disabled').length === 8) {
                    $('#magic-toggle').prop('disabled', false);
                }
            });
            
            $('.toggle').click(function() {
                // get currently toggle values
                var toggleValues = $.map($(this).closest('tr').find('.values').val().split(','), toNumeric);
                // toggle checkbox
                $.each(toggleValues, function(index, item) {
                    var $checkbox = $('[data-number='+item+']');
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                });
                
                // set as current
                setCurrentAsLast();
                
                // enable reset toggle button
                if ($('.toggle:checked').length) {
                    $('#reset-toggle').prop('disabled', false);
                } else {
                   $('#reset-toggle').prop('disabled', true);
                }
            });
            
            // calculate button click
            $('#magic-toggle').click(function() {
                // hide error message
                $('#error').hide();
                // reset toggles
                resetToggle();
                
                // get currently checked
                var $currentChecked = $('.light:checked');
                
                var solution = false;
                // try all 128 combinations
                for (var i = 0; i<128; i++) {
                    $.each([1,2,4,8,16,32,64], function(index, x) {
                        index = index + 1;
                        var $toggleBox = $('#toggle' + index);
                        var doToggle = false;
                        // is active
                        if (x & i) {
                            // toggle when not active
                            if (!$toggleBox.prop('checked')) {
                                doToggle = true;
                            }
                        } else {
                            // toggle when active
                            if ($toggleBox.prop('checked')) {
                                doToggle = true;
                            }
                        }
                        
                        // do the toggle when needed
                        if (doToggle) {
                            $toggleBox.click();
                        }
                    });
                    
                    // if all lamps correct
                    if ($('.light:checked').length === 20) {
                        break;
                    }
                }
                
                // show error message  when not correct and reset toggles
                if ($('.light:checked').length !== 20) {
                    $('#error').show();
                    resetToggle();
                }
                
                // uncheck all lights
                $('.light').prop('checked', false);
                // check old lights
                $currentChecked.prop('checked', true);
                // set old as current
                setCurrentAsLast();
            });
            
            // reset toggle click
            $('#reset-toggle').click(function() {
                // reset checkboxes
                resetToggle();
                $('#reset-toggle').prop('disabled', true);
            });
            
            // values double click
            $('.values').dblclick(function() {
                // allow edit on double click
                if ($(this).attr('id') === 'values0' || $('#analyse0').prop('disabled')) {
                    $(this).prop('readonly', false);
                }
            });
            
            // values exit
            $('.values').blur(function() {
                // set readonly on blur
                if (!$(this).prop('readonly')) {
                    $(this).prop('readonly', true);
                    if ($(this).attr('id') === 'values0' && !$('#analyse0').prop('disabled')) {
                        $('.analyse').prop('disabled', false);
                    }
                    
                    $('#' + $(this).attr('id').replace('values', 'toggle')).prop('disabled', false);
                    $('#' + $(this).attr('id').replace('values', 'analyse')).prop('disabled', true);
                }
            });
            
            // reset triggers
            $('#reset-trigger').click(function() {
                $('.analyse').prop('disabled', false);
                $('#analyse0').prop('disabled', true);
            });
            
            // last active history back
            $('#history-back').click(function() {
                lightHistoryIndex = lightHistoryIndex - 1;
                lastActiveHistory();
            });
            
            // last active history forward
            $('#history-forward').click(function() {
                lightHistoryIndex = lightHistoryIndex + 1;
                lastActiveHistory();
            });
        });
    </script>
    <script>
         (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
             (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
         })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

         ga('create', 'UA-71966211-1', 'auto');
         ga('set', 'anonymizeIp', true);
         ga('send', 'pageview');
     </script>
</body>
</html>
