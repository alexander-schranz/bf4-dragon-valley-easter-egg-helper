<!doctype html>
<html>
<head>
   <title>BF4: Dragon Valley Easter Egg Helper</title>
   <style>
        body {
            margin: 40px 20px;
            font-family: Times, Arial;
            background: url("http://subtlepatterns2015.subtlepatterns.netdna-cdn.com/patterns/simple_dashed.png");
            color: #333;
        }
        
        .wrapper {
            background: white;
            max-width: 560px;
            padding: 10px 20px 40px;
            margin: 0 auto;
            box-shadow: 0 0 10px #ccc;
        }
        
        th, td {
            text-align: left;
        }
        
        .grid td input {
            display: none;
        }
        
        #error {
            display: none;
            color: red;
            text-align: right;
        }
        
        .grid td label {
            display: block;
            text-align: center;
            line-height: 46px;
            width: 46px;
            height: 46px;
            background-color: grey;
            color: white;
            cursor: pointer;
            font-family: Sans-serif;
        }
        
        .text-center {
            text-align: center;
        }
        
        .grid td input:checked+label {
            color: #333;
            background-color: yellow;
        }
        
        .grid {
            background: url("http://subtlepatterns2015.subtlepatterns.netdna-cdn.com/patterns/gridme.png") top center;
            padding: 20px 10px;
        }
        
        a {
            color: blue;
        }
        
        h1 {
            font-size: 1.8em;
            text-align: center;
        }
        
        h2 {
            font-size: 1.5em;
            text-align: center;
        }
        
        p {
            text-align: center;
        }
        
        table {
            margin: 0 auto;
        }
        
        iframe {
            border: 0;
            display: block;
            margin: 0 auto;
        }
   </style>
</head>
<body>
    <div class="wrapper">
        <h1>
            BF4 Dragon Valley Easter Egg Helper<br/>
            <small>
                v2.2.2<br/>
                by Lexo91
            </small>
        </h1>
        <p>
            Inspired by
            <a href="https://www.youtube.com/watch?v=JuuzmOXL1bc" target="_blank"><strong>JackFraq</strong></a>
            and 
            <a href="https://www.youtube.com/watch?v=e6PcPuJOZ18" target="_blank"><strong>Apollo_v7</strong></a>
            <br/>
            I created a little helper to get all <strong>20 lamps</strong> burning.
        </p>
        <section>
            <fieldset class="grid">
                <legend>
                    Lamps
                </legend>
                <table>
                    <thead>
                        <tr>
                            <th colspan="7" class="text-center">
                                North
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <input type="checkbox" name="light1" id="light1" class="light" data-number="1" />
                                <label for="light1">1</label>
                            </td>
                            <td>
                                <input type="checkbox" name="light2" id="light2" class="light" data-number="2" />
                                <label for="light2">2</label>
                            </td>
                            <td>
                                <input type="checkbox" name="light3" id="light3" class="light" data-number="3" />
                                <label for="light3">3</label>
                            </td>
                            <td>
                                <input type="checkbox" name="light4" id="light4" class="light" data-number="4" />
                                <label for="light4">4</label>
                            </td>
                            <td>
                                <input type="checkbox" name="light5" id="light5" class="light" data-number="5" />
                                <label for="light5">5</label>
                            </td>
                            <td>
                                <input type="checkbox" name="light6" id="light6" class="light" data-number="6" />
                                <label for="light6">6</label>
                            </td>
                            <td>
                                <input type="checkbox" name="light7" id="light7" class="light" data-number="7" />
                                <label for="light7">7</label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" name="light20" id="light20" class="light" data-number="20" />
                                <label for="light20">20</label>
                            </td>
                            <td colspan="5">
                            </td>
                            <td>
                                <input type="checkbox" name="light8" id="light8" class="light" data-number="8" />
                                <label for="light8">8</label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" name="light19" id="light19" class="light" data-number="19" />
                                <label for="light19">19</label>
                            </td>
                            <td colspan="5">
                            </td>
                            <td>
                                <input type="checkbox" name="light9" id="light9" class="light" data-number="9" />
                                <label for="light9">9</label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" name="light18" id="light18" class="light" data-number="18" />
                                <label for="light18">18</label>
                            </td>
                            <td colspan="5">
                            </td>
                            <td>
                                <input type="checkbox" name="light10" id="light10" class="light" data-number="10" />
                                <label for="light10">10</label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" name="light17" id="light17" class="light" data-number="17" />
                                <label for="light17">17</label>
                            </td>
                            <td>
                                <input type="checkbox" name="light16" id="light16" class="light" data-number="16" />
                                <label for="light16">16</label>
                            </td>
                            <td>
                                <input type="checkbox" name="light15" id="light15" class="light" data-number="15" />
                                <label for="light15">15</label>
                            </td>
                            <td>
                                <input type="checkbox" name="light14" id="light14" class="light" data-number="14" />
                                <label for="light14">14</label>
                            </td>
                            <td>
                                <input type="checkbox" name="light13" id="light13" class="light" data-number="13" />
                                <label for="light13">13</label>
                            </td>
                            <td>
                                <input type="checkbox" name="light12" id="light12" class="light" data-number="12" />
                                <label for="light12">12</label>
                            </td>
                            <td>
                                <input type="checkbox" name="light11" id="light11" class="light" data-number="11" />
                                <label for="light11">11</label>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </fieldset>
        </section>
        <section>
            <fieldset>
                <legend>
                    Triggers
                </legend>
                <table>
                    <thead>
                        <tr>
                            <th>
                                Location
                            </th>
                            <th>
                                Lights
                            </th>
                            <th>
                                Set Lights
                            </th>
                            <th>
                                Toggle
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <label for="values0">Beginning</label>
                            </td>
                            <td>
                                <input type="text" name="values0" id="values0" readonly />
                            </td>
                            <td>
                                <button class="analyse" id="analyse0">
                                    Analyse
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label for="values1">Temple (H)</label>
                            </td>
                            <td>
                                <input type="text" name="values1" id="values1" readonly />
                            </td>
                            <td>
                                <button class="analyse" id="analyse1" disabled>
                                    Analyse
                                </button>
                            </td>
                            <td>
                                <input type="checkbox" class="toggle" id="toggle1" disabled />
                                <label for="toggle1"></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label for="values2">Furnace (C)</label>
                            </td>
                            <td>
                                <input type="text" name="values2" id="values2" readonly />
                            </td>
                            <td>
                                <button class="analyse" id="analyse2" disabled>
                                    Analyse
                                </button>
                            </td>
                            <td>
                                <input type="checkbox" class="toggle" id="toggle2" disabled />
                                <label for="toggle2"></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label for="values3">Tree (A)</label>
                            </td>
                            <td>
                                <input type="text" name="values3" id="values3" readonly />
                            </td>
                            <td>
                                <button class="analyse" id="analyse3" disabled>
                                    Analyse
                                </button>
                            </td>
                            <td>
                                <input type="checkbox" class="toggle" id="toggle3" disabled />
                                <label for="toggle3"></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label for="values4">Waterfall (D)</label>
                            </td>
                            <td>
                                <input type="text" name="values4" id="values4" readonly />
                            </td>
                            <td>
                                <button class="analyse" id="analyse4" disabled>
                                    Analyse
                                </button>
                            </td>
                            <td>
                                <input type="checkbox" class="toggle" id="toggle4" disabled />
                                <label for="toggle4"></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label for="values5">Pier (G)</label>
                            </td>
                            <td>
                                <input type="text" name="values5" id="values5" readonly />
                            </td>
                            <td>
                                <button class="analyse" id="analyse5" disabled>
                                    Analyse
                                </button>
                            </td>
                            <td>
                                <input type="checkbox" class="toggle" id="toggle5" disabled />
                                <label for="toggle5"></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label for="values6">Rock (E)</label>
                            </td>
                            <td>
                                <input type="text" name="values6" id="values6" readonly />
                            </td>
                            <td>
                                <button class="analyse" id="analyse6" disabled>
                                    Analyse
                                </button>
                            </td>
                            <td>
                                <input type="checkbox" class="toggle" id="toggle6" disabled />
                                <label for="toggle6"></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label for="values7">Pagoda (B)</label>
                            </td>
                            <td>
                                <input type="text" name="values7" id="values7" readonly />
                            </td>
                            <td>
                                <button class="analyse" id="analyse7" disabled>
                                    Analyse
                                </button>
                            </td>
                            <td>
                                <input type="checkbox" class="toggle" id="toggle7" disabled />
                                <label for="toggle7"></label>
                            </td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="2">
                                <button id="reset-toggle">
                                    Reset Toggle Status
                                </button>    
                            </td>
                            <td colspan="2">
                                <button id="magic-toggle">
                                    Magic Button
                                </button>    
                            </td>
                        </tr>
                        <tr>
                            <td colspan="4">
                                <div id="error">No solution found</div>
                            </td>
                        </tr>
                    </tfoot>
                </table>
            </fieldset>
        </section>
        <section>
            <h2>How to use this helper</h2>
            <ol>
                <li>Check all currently burning lights and click "Analyse" for "Beginning"</li>
                <li>Go the a button trigger it check all currently burning lights and click "Analyse"</li>
                <li>Continue doing this for the other buttons</li>
                <li>Click Reset Toggle Status if a Toggle is on and check the correctness of all burning lights</li>
                <li>Click on the 
                Button this will tell you which buttons you need to click again</li>
                <li><a href="http://battlelog.battlefield.com/bf4/forum/threadview/2955065246879560123/1/" target="_blank">Continue the Guide</a></li>
            </ol>
        </section>
        <section>
            <h2>Locations</h2>
            <iframe src="https://www.youtube.com/embed/e6PcPuJOZ18" width="480" height="260"></iframe>
        </section>
    </div>
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script>        
        $(document).ready(function() {
            var lastValues = [];
            $('.analyse').click(function() {
                var values = [];
                $('.light:checked').each(function() {
                    values.push($(this).data('number'));
                });
                
                for (var i in lastValues) {
                    var lastIndex = $.inArray(lastValues[i], values);
                    if (lastIndex !== -1) {
                        values.splice(lastIndex, 1);
                    } else {
                        values.push(lastValues[i]);
                    }
                }
                
                $(this).closest('tr').find('input[type=text]').val(values.join(','));
                
                lastValues = [];
                $('.light:checked').each(function() {
                    lastValues.push($(this).data('number'));
                });
                
                if ($(this).attr('id') === 'analyse0') {
                    $('.analyse').prop('disabled', false);
                }
                
                $(this).prop('disabled', true);
                $('#' + $(this).attr('id').replace('analyse', 'toggle')).prop('disabled', false);
            });
            
            $('.toggle').click(function() {
                var toggleValues = $(this).closest('tr').find('input[type=text]').val().split(',');
                $.each(toggleValues, function(index, item) {
                    var $checkbox = $('[data-number='+item+']');
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                });
                
                lastValues = [];
                $('.light:checked').each(function() {
                    lastValues.push($(this).data('number'));
                });
                
                if($(this).text().indexOf('[On]') !== -1) {
                    $(this).text('Toggle [Off]');
                } else {
                    $(this).text('Toggle [On]');
                }
            });
            
            $('#magic-toggle').click(function() {
                $('#error').hide();
                
                var $currentChecked = $('.light:checked');
                
                var solution = false;
                for (var i = 0; i<128; i++) {
                    $.each([1,2,4,8,16,32,64], function(index, x) {
                        index = index + 1;
                        var $toggleBox = $('#toggle' + index);
                        var doToggle = false;
                        if (x & i) {
                            if (!$toggleBox.prop('checked')) {
                                doToggle = true;
                            }
                        } else {
                            if ($toggleBox.prop('checked')) {
                                doToggle = true;
                            }
                        }
                        if (doToggle) {
                            $toggleBox.click();
                        }
                    });
                    
                    // if correct
                    if ($('.light:checked').length === 20) {
                        break;
                    }
                }
                
                if ($('.light:checked').length !== 20) {
                    $('#error').show();
                    $('.light').prop('checked', false);
                    $('.toggle').prop('checked', false);
                    $currentChecked.prop('checked', true);
                }
            });
            
            $('#reset-toggle').click(function() {
                $('.toggle').prop('checked', false);
            });
            
            $('input[type=text]').dblclick(function() {
                if ($(this).attr('id') === 'values0' || $('#analyse0').prop('disabled')) {
                    $(this).prop('readonly', false);
                }
            });
            
            $('input[type=text]').blur(function() {
                if (!$(this).prop('readonly')) {
                    $(this).prop('readonly', true);
                    if ($(this).attr('id') === 'values0' && !$('#analyse0').prop('disabled')) {
                        $('.analyse').prop('disabled', false);
                    }
                    
                    $('#' + $(this).attr('id').replace('values', 'toggle')).prop('disabled', false);
                    $('#' + $(this).attr('id').replace('values', 'analyse')).prop('disabled', true);
                }
            });
        });
    </script>
    <script>
         (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
             (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
         })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

         ga('create', 'UA-71966211-1', 'auto');
         ga('set', 'anonymizeIp', true);
         ga('send', 'pageview');
     </script>
</body>
</html>
